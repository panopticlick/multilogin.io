# Multilogin.io API - Cloudflare Worker Configuration
name = "multilogin-api"
main = "src/index.ts"
compatibility_date = "2024-05-01"
compatibility_flags = ["nodejs_compat"]

# Development
[env.development]
name = "multilogin-api-dev"

# Staging
[env.staging]
name = "multilogin-api-staging"
# routes = [{ pattern = "api-staging.multilogin.io", custom_domain = true }]

# Production
[env.production]
name = "multilogin-api"
# routes = [{ pattern = "api.multilogin.io", custom_domain = true }]

[[env.production.d1_databases]]
binding = "DB"
database_name = "multilogin-db"
database_id = "45f371a0-ee5a-4449-9d2c-f87920c7649d"
migrations_dir = "migrations"

# [[env.production.r2_buckets]]
# binding = "R2"
# bucket_name = "multilogin-sessions"

[[env.production.kv_namespaces]]
binding = "KV"
id = "a865c3fe71c643d5a408faa521c3a3b3"

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "multilogin-db"
database_id = "45f371a0-ee5a-4449-9d2c-f87920c7649d"
migrations_dir = "migrations"

# R2 Storage for session data (optional - requires R2 to be enabled in dashboard)
# [[r2_buckets]]
# binding = "R2"
# bucket_name = "multilogin-sessions"

# KV Namespace for rate limiting and caching
[[kv_namespaces]]
binding = "KV"
id = "a865c3fe71c643d5a408faa521c3a3b3"

# Environment variables (set via wrangler secret)
# JWT_SECRET - Secret for JWT signing
# INTERNAL_WEBHOOK_SECRET - Optional internal webhook signing secret

# Observability
[observability]
enabled = true

# Cron Triggers for scheduled tasks (Free tier: max 3 crons)
[triggers]
crons = [
  "0 * * * *",     # Every hour - Health checks
  "0 3 * * *",     # Daily 3 AM - Cleanup
  "0 9 * * 1",     # Weekly Monday 9 AM - Aging notifications
]

# Tail consumers for logging
# [[tail_consumers]]
# service = "multilogin-logs"
